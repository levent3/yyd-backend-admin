<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TÃ¼rkiye Finans Test - 3D Secure</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .test-cards {
            background: #fff3e0;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        label {
            font-weight: bold;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¦ TÃ¼rkiye Finans VPOS Test</h1>

        <div class="info">
            <h3>ğŸ“‹ Test Bilgileri:</h3>
            <p><strong>Test Endpoint:</strong> http://localhost:5000/api/donations/turkiye-finans/test</p>
            <p><strong>Callback URL:</strong> http://localhost:5000/api/donations/turkiye-finans/callback</p>
        </div>

        <div class="test-cards">
            <h3>ğŸ’³ Test KartlarÄ±:</h3>
            <ul>
                <li><strong>5218487962459752</strong></li>
                <li><strong>4446763125813623</strong></li>
                <li><strong>5200190005138652</strong></li>
            </ul>
            <p><strong>CVV:</strong> 000 (BaÅŸarÄ±lÄ± iÅŸlem iÃ§in)</p>
            <p><strong>Son Kullanma:</strong> Ä°leri bir tarih (Ã¶rn: 12/25)</p>
        </div>

        <h3>âš™ï¸ Test Parametreleri:</h3>

        <label>Tutar (TL):</label>
        <input type="number" id="amount" value="10" min="1" step="0.01">

        <label>Tekrarlayan Ã–deme SayÄ±sÄ± (opsiyonel):</label>
        <input type="number" id="recurringNumber" placeholder="Ã–rn: 12 (boÅŸ bÄ±rakabilirsiniz)">

        <label>Tekrarlayan Ã–deme SÄ±klÄ±ÄŸÄ±:</label>
        <select id="recurringUnit">
            <option value="">Yok (Tek Seferlik)</option>
            <option value="M" selected>M - AylÄ±k</option>
            <option value="W">W - HaftalÄ±k</option>
            <option value="D">D - GÃ¼nlÃ¼k</option>
        </select>

        <label>AralÄ±k DeÄŸeri:</label>
        <input type="number" id="recurringFreq" placeholder="Ã–rn: 1 (her 1 ay/hafta/gÃ¼n)">

        <button onclick="initiate3DPayment()">ğŸš€ 3D Secure Ã–deme BaÅŸlat</button>

        <div class="loading" id="loading">
            <p>â³ 3D Secure formu oluÅŸturuluyor...</p>
        </div>
    </div>

    <!-- 3D Form will be inserted here -->
    <div id="formContainer"></div>

    <script>
        async function initiate3DPayment() {
            const amount = document.getElementById('amount').value;
            const recurringNumber = document.getElementById('recurringNumber').value;
            const recurringUnit = document.getElementById('recurringUnit').value;
            const recurringFreq = document.getElementById('recurringFreq').value;

            const payload = {
                amount: parseFloat(amount)
            };

            // Add recurring params if provided
            if (recurringNumber && recurringUnit && recurringFreq) {
                payload.recurringPaymentNumber = parseInt(recurringNumber);
                payload.recurringFrequencyUnit = recurringUnit;
                payload.recurringFrequency = parseInt(recurringFreq);
            }

            document.getElementById('loading').style.display = 'block';

            try {
                const response = await fetch('http://localhost:5000/api/donations/turkiye-finans/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (data.success) {
                    console.log('âœ… Response:', data);

                    // Create and submit form
                    const form = document.createElement('form');
                    form.method = data.data.formData.method;
                    form.action = data.data.formData.action;

                    // Add all fields
                    Object.keys(data.data.formData.fields).forEach(key => {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = key;
                        input.value = data.data.formData.fields[key];
                        form.appendChild(input);
                    });

                    document.getElementById('formContainer').appendChild(form);

                    alert('âœ… Form oluÅŸturuldu! 3D Secure sayfasÄ±na yÃ¶nlendiriliyorsunuz...\n\nTest kartÄ± kullanÄ±n:\n5218487962459752\nCVV: 000\nSon Kullanma: 12/25');

                    form.submit();
                } else {
                    alert('âŒ Hata: ' + data.message);
                    document.getElementById('loading').style.display = 'none';
                }
            } catch (error) {
                alert('âŒ Ä°stek hatasÄ±: ' + error.message);
                document.getElementById('loading').style.display = 'none';
            }
        }
    </script>
</body>
</html>

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminModule {
  id           Int                    @id @default(autoincrement())
  name         String
  moduleKey    String                 @unique
  path         String?
  icon         String?
  displayOrder Int                    @default(0)
  parentId     Int?
  parent       AdminModule?           @relation("SubModules", fields: [parentId], references: [id], onDelete: Cascade)
  subModules   AdminModule[]          @relation("SubModules")
  permissions  RoleModulePermission[]
}

model RoleModulePermission {
  roleId      Int
  moduleId    Int
  permissions Json        @default("{\"read\": false, \"create\": false, \"delete\": false, \"update\": false}")
  module      AdminModule @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  role        Role        @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([roleId, moduleId])
}

model Role {
  id                Int                    @id @default(autoincrement())
  name              String                 @unique
  accessibleModules RoleModulePermission[]
  users             User[]
}

model User {
  id                   Int           @id @default(autoincrement())
  username             String        @unique
  passwordHash         String
  email                String        @unique
  fullName             String?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  roleId               Int
  uploadedGalleryItems GalleryItem[]
  authoredNews         News[]
  authoredPages        Page[]
  createdProjects      Project[]
  role                 Role          @relation(fields: [roleId], references: [id])

  @@index([email])
  @@index([username])
  @@index([roleId])
}

model Project {
  id                 Int                  @id @default(autoincrement())
  imageUrl           String?
  isActive           Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  authorId           Int?
  beneficiaryCount   Int?                 @default(0)
  budget             Float?
  category           String?
  collectedAmount    Float?               @default(0)
  country            String?
  coverImage         String?
  displayOrder       Int                  @default(0)
  endDate            DateTime?
  isFeatured         Boolean              @default(false)
  location           String?
  priority           String               @default("medium")
  startDate          DateTime?
  status             String               @default("active")
  targetAmount       Float?
  donorCount         Int?                 @default(0)
  shortCode          String?              @unique @db.VarChar(20)
  brochures          Brochure[]
  cartItems          CartItem[]
  donations          Donation[]
  galleryItems       GalleryItem[]
  author             User?                @relation(fields: [authorId], references: [id])
  settings           ProjectSettings?
  translations       ProjectTranslation[]
  recurringDonations RecurringDonation[]
  successStories     SuccessStory[]

  @@index([status])
  @@index([isActive])
  @@index([isFeatured])
  @@index([category])
  @@index([createdAt])
}

model ProjectTranslation {
  id          Int      @id @default(autoincrement())
  projectId   Int
  language    String
  title       String
  slug        String
  description String?
  content     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, language])
  @@unique([language, slug])
  @@index([language])
  @@index([slug])
}

model News {
  id           Int               @id @default(autoincrement())
  imageUrl     String?
  status       String            @default("draft")
  publishedAt  DateTime?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  authorId     Int?
  author       User?             @relation(fields: [authorId], references: [id])
  translations NewsTranslation[]

  @@index([status])
  @@index([publishedAt])
  @@index([createdAt])
}

model NewsTranslation {
  id        Int      @id @default(autoincrement())
  newsId    Int
  language  String
  title     String
  slug      String
  summary   String?
  content   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  news      News     @relation(fields: [newsId], references: [id], onDelete: Cascade)

  @@unique([newsId, language])
  @@unique([language, slug])
  @@index([language])
  @@index([slug])
}

model GalleryItem {
  id         Int      @id @default(autoincrement())
  title      String?
  mediaType  String
  fileUrl    String
  createdAt  DateTime @default(now())
  projectId  Int?
  uploaderId Int?
  project    Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  uploader   User?    @relation(fields: [uploaderId], references: [id])

  @@index([mediaType])
  @@index([projectId])
  @@index([createdAt])
}

model Page {
  id            Int               @id @default(autoincrement())
  pageType      String            @default("general")
  status        String            @default("draft")
  isPublic      Boolean           @default(true)
  isActive      Boolean           @default(true)
  displayOrder  Int               @default(0)
  featuredImage String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  publishedAt   DateTime?
  authorId      Int?
  author        User?             @relation(fields: [authorId], references: [id])
  translations  PageTranslation[]

  @@index([pageType])
  @@index([status])
  @@index([isPublic])
  @@index([isActive])
  @@index([publishedAt])
}

model PageTranslation {
  id              Int      @id @default(autoincrement())
  pageId          Int
  language        String
  title           String
  slug            String
  content         String?
  excerpt         String?
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  builderData     Json?
  builderHtml     String?
  builderCss      String?
  page            Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@unique([pageId, language])
  @@unique([language, slug])
  @@index([language])
  @@index([slug])
}

model Donor {
  id                 Int                 @id @default(autoincrement())
  fullName           String
  email              String              @unique
  phoneNumber        String?
  createdAt          DateTime            @default(now())
  address            String?
  city               String?
  country            String?             @default("TÃ¼rkiye")
  taxNumber          String?
  updatedAt          DateTime            @updatedAt
  donations          Donation[]
  recurringDonations RecurringDonation[]

  @@index([email])
  @@index([createdAt])
}

model Donation {
  id                  String               @id @default(uuid())
  amount              Float
  transactionId       String?              @unique
  createdAt           DateTime             @default(now())
  donorId             Int?
  completedAt         DateTime?
  currency            String               @default("TRY")
  donorEmail          String?
  donorName           String?
  donorPhone          String?
  isAnonymous         Boolean              @default(false)
  message             String?
  paymentGateway      String?
  paymentMethod       String
  paymentStatus       String               @default("pending")
  receiptSent         Boolean              @default(false)
  updatedAt           DateTime             @updatedAt
  failedAt            DateTime?
  gatewayResponse     Json?
  installment         Int?                 @default(1)
  ipAddress           String?
  receiptUrl          String?
  repeatCount         Int?                 @default(1)
  userAgent           String?
  dedicatedTo         String?
  dedicationMessage   String?
  dedicationType      String?
  isDedicated         Boolean              @default(false)
  smsKeyword          String?
  smsShortCode        String?
  isSacrifice         Boolean              @default(false)
  sacrificeType       String?
  shareCount          Int?                 @default(1)
  sharePrice          Float?
  projectId           Int?
  donor               Donor?               @relation(fields: [donorId], references: [id])
  project             Project?             @relation(fields: [projectId], references: [id])
  paymentTransactions PaymentTransaction[]

  @@index([paymentStatus])
  @@index([donorId])
  @@index([projectId])
  @@index([createdAt])
  @@index([completedAt])
  @@index([paymentGateway])
  @@index([isDedicated])
}

model RecurringDonation {
  id                   Int                  @id @default(autoincrement())
  amount               Float
  currency             String               @default("TRY")
  frequency            String               @default("monthly")
  paymentMethod        String               @default("credit_card")
  cardToken            String?
  status               String               @default("active")
  nextPaymentDate      DateTime?
  lastPaymentDate      DateTime?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  donorId              Int
  cardBrand            String?
  cardMask             String?
  endedAt              DateTime?
  failedAttempts       Int                  @default(0)
  lastFailureReason    String?
  notificationSent     Boolean              @default(false)
  pausedAt             DateTime?
  paymentGateway       String?              @default("iyzico")
  startedAt            DateTime             @default(now())
  totalPaymentsMade    Int                  @default(0)
  totalPaymentsPlanned Int?
  projectId            Int?
  paymentTransactions  PaymentTransaction[]
  donor                Donor                @relation(fields: [donorId], references: [id], onDelete: Cascade)
  project              Project?             @relation(fields: [projectId], references: [id])

  @@index([donorId])
  @@index([status])
  @@index([nextPaymentDate])
  @@index([projectId])
}

model BankAccount {
  id            Int      @id @default(autoincrement())
  bankName      String
  accountName   String
  iban          String   @unique
  swift         String?
  accountNumber String?
  branch        String?
  currency      String   @default("TRY")
  isActive      Boolean  @default(true)
  displayOrder  Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Volunteer {
  id          Int      @id @default(autoincrement())
  fullName    String
  email       String
  phoneNumber String?
  message     String?
  status      String   @default("new")
  submittedAt DateTime @default(now())
}

model JobPosition {
  id               Int                 @id @default(autoincrement())
  title            String
  slug             String              @unique
  description      String
  requirements     String?
  responsibilities String?
  qualifications   String?
  department       String?
  location         String?
  employmentType   String?
  isActive         Boolean             @default(true)
  isFeatured       Boolean             @default(false)
  displayOrder     Int                 @default(0)
  deadline         DateTime?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  applications     CareerApplication[]
}

model CareerApplication {
  id                   Int          @id @default(autoincrement())
  fullName             String
  email                String
  phoneNumber          String?
  position             String?
  coverLetter          String?
  cvUrl                String
  status               String       @default("new")
  submittedAt          DateTime     @default(now())
  acceptsNotifications Boolean      @default(false)
  jobPositionId        Int?
  source               String?
  jobPosition          JobPosition? @relation(fields: [jobPositionId], references: [id])
}

model ContactMessage {
  id          Int      @id @default(autoincrement())
  fullName    String
  email       String
  phoneNumber String?
  subject     String
  message     String
  status      String   @default("new")
  submittedAt DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PaymentTransaction {
  id                   String             @id @default(uuid())
  amount               Float
  currency             String             @default("TRY")
  status               String             @default("pending")
  paymentGateway       String
  gatewayTransactionId String?
  gatewayResponse      Json?
  gatewayErrorCode     String?
  gatewayErrorMessage  String?
  threeDSecure         Boolean            @default(false)
  conversationId       String?
  attemptNumber        Int                @default(1)
  retryable            Boolean            @default(false)
  ipAddress            String?
  userAgent            String?
  createdAt            DateTime           @default(now())
  processedAt          DateTime?
  donationId           String?
  recurringDonationId  Int?
  donation             Donation?          @relation(fields: [donationId], references: [id], onDelete: Cascade)
  recurringDonation    RecurringDonation? @relation(fields: [recurringDonationId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([paymentGateway])
  @@index([donationId])
  @@index([recurringDonationId])
  @@index([createdAt])
}

model CartItem {
  id           String   @id @default(uuid())
  sessionId    String
  amount       Float
  currency     String   @default("TRY")
  donationType String   @default("one_time")
  repeatCount  Int?     @default(1)
  donorName    String?
  donorEmail   String?
  donorPhone   String?
  createdAt    DateTime @default(now())
  expiresAt    DateTime
  projectId    Int?
  project      Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([projectId])
  @@index([expiresAt])
}

model ValidationRule {
  id           Int      @id @default(autoincrement())
  entityType   String
  fieldName    String
  ruleType     String
  ruleValue    String?
  errorMessage Json
  priority     Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([entityType, fieldName, ruleType])
  @@index([entityType])
  @@index([fieldName])
  @@index([isActive])
}

model ProjectSettings {
  id                 Int      @id @default(autoincrement())
  projectId          Int      @unique
  presetAmounts      Json?
  minAmount          Float?
  maxAmount          Float?
  allowRepeat        Boolean  @default(true)
  minRepeatCount     Int?     @default(2)
  maxRepeatCount     Int?     @default(18)
  allowOneTime       Boolean  @default(true)
  allowRecurring     Boolean  @default(true)
  allowedFrequencies Json?
  allowDedication    Boolean  @default(false)
  allowAnonymous     Boolean  @default(true)
  requireMessage     Boolean  @default(false)
  isSacrifice        Boolean  @default(false)
  sacrificeConfig    Json?
  showProgress       Boolean  @default(true)
  showDonorCount     Boolean  @default(true)
  showBeneficiaries  Boolean  @default(true)
  impactMetrics      Json?
  successStories     Json?
  customCss          String?
  customJs           String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  project            Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model SystemSettings {
  id           Int      @id @default(autoincrement())
  settingKey   String   @unique
  settingValue Json
  description  String?
  category     String?
  isActive     Boolean  @default(true)
  isPublic     Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category])
  @@index([isActive])
  @@index([isPublic])
}

model BrandAsset {
  id           Int      @id @default(autoincrement())
  fileName     String
  fileType     String
  fileUrl      String
  thumbnailUrl String?
  fileSize     Int?
  language     String?
  version      String?
  description  String?
  isActive     Boolean  @default(true)
  displayOrder Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([fileType])
  @@index([isActive])
}

model Brochure {
  id           Int                   @id @default(autoincrement())
  pdfUrl       String
  thumbnailUrl String?
  fileSize     Int?
  category     String?
  projectId    Int?
  isActive     Boolean               @default(true)
  isFeatured   Boolean               @default(false)
  displayOrder Int                   @default(0)
  publishedAt  DateTime?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  project      Project?              @relation(fields: [projectId], references: [id])
  translations BrochureTranslation[]

  @@index([category])
  @@index([isActive])
  @@index([publishedAt])
}

model BrochureTranslation {
  id          Int      @id @default(autoincrement())
  brochureId  Int
  language    String
  title       String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  brochure    Brochure @relation(fields: [brochureId], references: [id], onDelete: Cascade)

  @@unique([brochureId, language])
  @@index([language])
}

model PublicSpot {
  id           Int                     @id @default(autoincrement())
  videoUrl     String
  videoType    String                  @default("youtube")
  thumbnailUrl String?
  duration     Int?
  category     String?
  viewCount    Int                     @default(0)
  isActive     Boolean                 @default(true)
  isFeatured   Boolean                 @default(false)
  displayOrder Int                     @default(0)
  publishedAt  DateTime?
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  translations PublicSpotTranslation[]

  @@index([category])
  @@index([isActive])
  @@index([publishedAt])
}

model PublicSpotTranslation {
  id          Int        @id @default(autoincrement())
  spotId      Int
  language    String
  title       String
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  spot        PublicSpot @relation(fields: [spotId], references: [id], onDelete: Cascade)

  @@unique([spotId, language])
  @@index([language])
}

model SuccessStory {
  id           Int                       @id @default(autoincrement())
  coverImage   String?
  images       Json?
  location     String?
  country      String?
  projectId    Int?
  isActive     Boolean                   @default(true)
  isFeatured   Boolean                   @default(false)
  displayOrder Int                       @default(0)
  publishedAt  DateTime?
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  project      Project?                  @relation(fields: [projectId], references: [id])
  translations SuccessStoryTranslation[]

  @@index([location])
  @@index([isActive])
  @@index([publishedAt])
}

model SuccessStoryTranslation {
  id              Int          @id @default(autoincrement())
  storyId         Int
  language        String
  title           String
  slug            String
  summary         String?
  content         String?
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  story           SuccessStory @relation(fields: [storyId], references: [id], onDelete: Cascade)

  @@unique([storyId, language])
  @@unique([language, slug])
  @@index([language])
  @@index([slug])
}

model MediaCoverage {
  id           Int      @id @default(autoincrement())
  title        String
  source       String
  sourceType   String   @default("internet")
  externalUrl  String?
  imageUrl     String?
  category     String?
  isActive     Boolean  @default(true)
  isFeatured   Boolean  @default(false)
  displayOrder Int      @default(0)
  publishedAt  DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([sourceType])
  @@index([isActive])
  @@index([publishedAt])
}

model ActivityArea {
  id           Int                      @id @default(autoincrement())
  icon         String?
  displayOrder Int                      @default(0)
  isActive     Boolean                  @default(true)
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt
  translations ActivityAreaTranslation[]

  @@index([isActive])
  @@index([displayOrder])
}

model ActivityAreaTranslation {
  id              Int          @id @default(autoincrement())
  activityAreaId  Int
  language        String
  title           String
  slug            String
  description     String?      @db.Text
  content         String?      @db.Text
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  activityArea    ActivityArea @relation(fields: [activityAreaId], references: [id], onDelete: Cascade)

  @@unique([activityAreaId, language])
  @@unique([language, slug])
  @@index([language])
  @@index([slug])
}

model Bank {
  id              Int       @id @default(autoincrement())
  name            String
  isOurBank       Boolean   @default(false)
  isVirtualPosActive Boolean @default(false)
  isActive        Boolean   @default(true)
  displayOrder    Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  binCodes        BinCode[]

  @@index([isActive])
  @@index([displayOrder])
}

model BinCode {
  id        Int      @id @default(autoincrement())
  binCode   String   @unique
  bankId    Int
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  bank      Bank     @relation(fields: [bankId], references: [id], onDelete: Cascade)

  @@index([bankId])
  @@index([isActive])
  @@index([binCode])
}
